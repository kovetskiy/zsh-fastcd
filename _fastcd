#compdef fastcd

function _fastcd() {
    # directory may be '$GOPATH/src', so need expand
    local directory=$(eval echo `echo $words[2]`)

    local maxdepth=$words[3]

    cd $directory
    if [ $? -ne 0 ]; then
        return 1
    fi

    for file in `
        find . -maxdepth $maxdepth -type d -not -iwholename '*.git*' -print0 \
            | xargs -0 -n1 basename | sort | uniq -u
        `; do
        compadd $file
    done

    cd $OLDPWD
}

_fastcd "${@}"
